import{w as N,r as i,b as d,u as C,a as b,d as f,j as e,L as y,a8 as w,a9 as I}from"./index-BBlMiJUd.js";import{u as S}from"./useToast-XQdV5Y45.js";const E=()=>{const{id:t}=N(),[l,_]=i.useState(null),[u,h]=i.useState(""),{comments:x,loading:p}=d(s=>s.CommentsReducer),{user:m}=d(s=>s.userReducer),r=C(),j=b(),[o,c]=i.useState(""),v=m?.avatarUrl,{toast:a}=S(),g=async s=>{if(s?.preventDefault(),!!o.trim()){if(!m){a.error("Please login to comment.");return}try{await Promise.resolve(r(I({id:t,comment:o}))),a.success("Comment posted",{duration:2200}),c("")}catch(n){a.error(n?.message||"Failed to post comment",{duration:3e3})}}};return i.useEffect(()=>{t&&r(f(t))},[r,t]),p?e.jsx(y,{}):e.jsxs("div",{className:"comments-page",children:[e.jsxs("header",{className:"comments-header",children:[e.jsx("button",{onClick:()=>j(-1),className:"back-btn",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",fill:"currentColor",viewBox:"0 0 256 256",children:e.jsx("path",{d:"M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"})})}),e.jsx("h2",{children:"Comments"})]}),e.jsx("div",{className:"comments-list",children:x.map(s=>e.jsxs("div",{className:"comment",children:[e.jsx("div",{className:"avatar",style:{backgroundImage:`url(${s.profile?.avatarUrl})`}}),e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"content_top",children:[e.jsxs("div",{className:"meta",children:[e.jsx("p",{className:"name",children:s.profile?.displayName||"Unknown User"}),e.jsx("p",{className:"time",children:new Date(s.createdAt).toLocaleString("en-IN",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"short"})})]}),s.user===m?.userId?._id&&e.jsx("div",{className:"actions",children:e.jsx("button",{onClick:async()=>{try{await Promise.resolve(r(w({postId:t,commentId:s._id}))),a.success("Comment deleted",{duration:2e3})}catch(n){a.error(n?.message||"Failed to delete comment")}},children:e.jsx("i",{className:"ri-delete-bin-4-line delete__cmnt"})})})]}),l!==s._id?e.jsx("p",{className:"text",children:s.comment}):e.jsx("input",{type:"text",value:u,onChange:n=>h(n.target.value)})]})]},s._id))}),e.jsxs("div",{className:"comment-input",children:[e.jsx("div",{className:"avatar",style:{backgroundImage:`url('${v}')`}}),e.jsxs("form",{className:"input-box",onSubmit:g,children:[e.jsx("input",{value:o,onChange:s=>c(s.target.value),type:"text",placeholder:"Add a comment..."}),e.jsx("button",{className:"send-btn",disabled:!o.trim(),type:"submit",children:"Send"})]})]})]})};export{E as default};
