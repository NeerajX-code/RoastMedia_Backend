import{r as n,h as H,j as e,i as A,k as I,P as U,l as $,m as O,n as W,b as T,o as L,u as X,L as K,E as Y,p as q,X as z,q as F,s as J,t as V}from"./index-BBlMiJUd.js";import{u as Z}from"./useToast-XQdV5Y45.js";class Q extends n.Component{getSnapshotBeforeUpdate(c){const s=this.props.childRef.current;if(s&&c.isPresent&&!this.props.isPresent){const a=s.offsetParent,h=A(a)&&a.offsetWidth||0,r=this.props.sizeRef.current;r.height=s.offsetHeight||0,r.width=s.offsetWidth||0,r.top=s.offsetTop,r.left=s.offsetLeft,r.right=h-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ee({children:o,isPresent:c,anchorX:s,root:a}){const h=n.useId(),r=n.useRef(null),p=n.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:v}=n.useContext(H);return n.useInsertionEffect(()=>{const{width:f,height:l,top:_,left:i,right:m}=p.current;if(c||!r.current||!f||!l)return;const g=s==="left"?`left: ${i}`:`right: ${m}`;r.current.dataset.motionPopId=h;const u=document.createElement("style");v&&(u.nonce=v);const j=a??document.head;return j.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${h}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${l}px !important;
            ${g}px !important;
            top: ${_}px !important;
          }
        `),()=>{j.contains(u)&&j.removeChild(u)}},[c]),e.jsx(Q,{isPresent:c,childRef:r,sizeRef:p,children:n.cloneElement(o,{ref:r})})}const te=({children:o,initial:c,isPresent:s,onExitComplete:a,custom:h,presenceAffectsLayout:r,mode:p,anchorX:v,root:f})=>{const l=I(ne),_=n.useId();let i=!0,m=n.useMemo(()=>(i=!1,{id:_,initial:c,isPresent:s,custom:h,onExitComplete:g=>{l.set(g,!0);for(const u of l.values())if(!u)return;a&&a()},register:g=>(l.set(g,!1),()=>l.delete(g))}),[s,l,a]);return r&&i&&(m={...m}),n.useMemo(()=>{l.forEach((g,u)=>l.set(u,!1))},[s]),n.useEffect(()=>{!s&&!l.size&&a&&a()},[s]),p==="popLayout"&&(o=e.jsx(ee,{isPresent:s,anchorX:v,root:f,children:o})),e.jsx(U.Provider,{value:m,children:o})};function ne(){return new Map}const S=o=>o.key||"";function G(o){const c=[];return n.Children.forEach(o,s=>{n.isValidElement(s)&&c.push(s)}),c}const se=({children:o,custom:c,initial:s=!0,onExitComplete:a,presenceAffectsLayout:h=!0,mode:r="sync",propagate:p=!1,anchorX:v="left",root:f})=>{const[l,_]=$(p),i=n.useMemo(()=>G(o),[o]),m=p&&!l?[]:i.map(S),g=n.useRef(!0),u=n.useRef(i),j=I(()=>new Map),[P,b]=n.useState(i),[C,D]=n.useState(i);O(()=>{g.current=!1,u.current=i;for(let x=0;x<C.length;x++){const d=S(C[x]);m.includes(d)?j.delete(d):j.get(d)!==!0&&j.set(d,!1)}},[C,m.length,m.join("-")]);const R=[];if(i!==P){let x=[...i];for(let d=0;d<C.length;d++){const w=C[d],N=S(w);m.includes(N)||(x.splice(d,0,w),R.push(w))}return r==="wait"&&R.length&&(x=R),D(G(x)),b(i),null}const{forceRender:k}=n.useContext(W);return e.jsx(e.Fragment,{children:C.map(x=>{const d=S(x),w=p&&!l?!1:i===C||m.includes(d),N=()=>{if(j.has(d))j.set(d,!0);else return;let E=!0;j.forEach(B=>{B||(E=!1)}),E&&(k?.(),D(u.current),p&&_?.(),a&&a())};return e.jsx(te,{isPresent:w,initial:!g.current||s?void 0:!1,custom:c,presenceAffectsLayout:h,mode:r,root:f,onExitComplete:w?void 0:N,anchorX:v,children:x},d)})})},re=({setShowCurrentCaption:o})=>{const{captions:c}=T(a=>a.CaptionReducer),s=a=>{o(a)};return e.jsx(e.Fragment,{children:c.length>0?e.jsx(L.div,{className:"previous_caption",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:e.jsx(se,{children:c.map((a,h)=>e.jsx(L.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},children:e.jsx("ul",{style:{padding:"10px 30px"},children:e.jsx("li",{onClick:()=>s(a.response),style:{color:"white",cursor:"pointer"},whileHover:{scale:1.05,color:"#a29bfe"},whileTap:{scale:.95},children:a.response})})},h))})}):e.jsx(L.p,{style:{padding:"clamp(0.8rem,1vw,1rem)",color:"white"},initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},children:"there is no such comments"})})},oe=5*1024*1024,ae=["image/jpeg","image/png","image/gif","image/webp"],ce=()=>{const{captions:o,loading:c,captionError:s}=T(t=>t.CaptionReducer),{createPostLoading:a}=T(t=>t.PostReducer),h=X(),{toast:r}=Z(),[p,v]=n.useState(null),[f,l]=n.useState(null),[_,i]=n.useState(null),[m,g]=n.useState("Desi_Uncle"),[u,j]=n.useState(!1),[P,b]=n.useState(null),C=n.useRef(null),D=n.useRef(null);n.useEffect(()=>()=>{f&&URL.revokeObjectURL(f)},[f]),n.useEffect(()=>{o.length>0&&b(o[o.length-1].response)},[o]);const R=t=>ae.includes(t.type)?t.size>oe?"File size must be under 5MB":null:"Only image files (JPG, PNG, GIF, WEBP) are allowed",k=t=>{const y=R(t);if(y){i(y),v(null),l(null);return}i(null),v(t),l(URL.createObjectURL(t))},x=t=>{const y=t.target.files?.[0];y&&k(y)},d=t=>{t.preventDefault();const y=t.dataTransfer.files?.[0];y&&k(y)},w=()=>{if(!p){i("Please select an image before submitting."),r.error("Please select an image before generating caption.");return}if(o.length>=5){r.error("You reached the max limit of generating captions for this image.",{duration:3500,position:"top-right"});return}const t=new FormData;t.append("image",p),t.append("personality",m),h(J(t))},N=T(t=>t.userReducer.user),E=async()=>{if(!N){r.error("Please login to create or save posts.");return}if(!p||!P){i("Please give content before submitting."),r.error("Add image and generate a caption before creating the post.");return}const t=new FormData;t.append("image",p),t.append("showCurrentCaption",P);try{await h(V(t)).unwrap(),r.success("Post created successfully!",{duration:2500}),h(F()),l(null),b(""),v(null),i("")}catch(y){r.error(typeof y=="string"?y:y?.message||"Failed to create post",{duration:3500})}},B=()=>{j(t=>!t)},M=()=>{l(null),b(null),h(F())};return c||a?e.jsx(K,{}):e.jsxs("div",{className:"roast-generator",children:[e.jsx("div",{className:"roast-generator__header",children:e.jsx("h2",{className:"roast-generator__title",children:"Roast Generator"})}),!f&&e.jsxs("div",{className:"roast-generator__content",children:[e.jsxs("h2",{className:"roast-generator__main-title",children:["Give"," ",e.jsx("span",{style:{color:"#39E079",fontSize:"clamp(1.9rem, 2vw, 2.1rem)"},children:"Your Image"})]}),e.jsx("p",{className:"roast-generator__subtitle",children:"and See the magic"})]}),e.jsx(Y,{message:s,loading:c,clearAction:q,isvisible:!0}),!f&&e.jsx("div",{className:"roast-generator__dropzone-wrapper",children:e.jsxs("div",{className:"roast-generator__dropzone",onDragOver:t=>t.preventDefault(),onDrop:d,children:[e.jsxs("div",{className:"roast-generator__dropzone-texts",children:[e.jsx("p",{className:"dropzone-title",children:"Drop your image here"}),e.jsx("p",{className:"dropzone-or",children:"Or"}),e.jsx("p",{className:"dropzone-subtitle",children:"Browse your files"})]}),e.jsxs("div",{className:"roast-generator__capture-btn",children:[e.jsx("button",{type:"button",className:"choose-btn desktop-only",onClick:()=>C.current.click(),children:"Choose Image"}),e.jsx("input",{ref:C,type:"file",accept:"image/*",hidden:!0,onChange:x}),e.jsx("button",{type:"button",className:"choose-btn mobile-only",onClick:()=>D.current.click(),children:"Gallery"}),e.jsx("input",{ref:D,type:"file",accept:"image/*",hidden:!0,onChange:x}),_&&e.jsx("p",{style:{color:"red",marginTop:"10px"},children:_})]})]})}),f&&e.jsxs("div",{className:"bottom",children:[e.jsxs("div",{children:[e.jsx("button",{onClick:B,className:"previous-comments",children:u?e.jsx(z,{}):"Previous Captions"}),u&&e.jsx(re,{setShowCurrentCaption:b})]}),e.jsxs("div",{className:"preview-wrapper",children:[e.jsx("button",{className:"clear-preview",onClick:M,children:e.jsx(z,{})}),e.jsx("img",{src:f,alt:"preview",style:{borderRadius:"12px",width:"100%",height:"100%",maxHeight:"300px",objectFit:"contain"}})]}),o.length>0&&e.jsx("div",{className:"captions",children:P||"There is no comment."}),e.jsxs("div",{className:"roast-generator__footer",children:[e.jsxs("select",{className:"dropdown",value:m,onChange:t=>g(t.target.value),children:[e.jsx("option",{value:"Desi_Uncle",children:"Desi Uncle"}),e.jsx("option",{value:"Desi_Bua",children:"Desi Bua"}),e.jsx("option",{value:"Desi_Aunty",children:"Desi Aunty"}),e.jsx("option",{value:"Desi_Dost",children:"Desi Dost"}),e.jsx("option",{value:"Shayar_Banda",children:"Shayar Banda"}),e.jsx("option",{value:"Bambaiya_Tapori",children:"Bambaiya Tapori"}),e.jsx("option",{value:"Gyaani_Baba",children:"Gyaani Baba"}),e.jsx("option",{value:"Petty_Aunty",children:"Petty Aunty"}),e.jsx("option",{value:"Delhi_Launda",children:"Delhi Launda"}),e.jsx("option",{value:"Punjabi_Paji",children:"Punjabi Paji"}),e.jsx("option",{value:"South_Anna",children:"South Anna"}),e.jsx("option",{value:"Gujju_Ben",children:"Gujju Ben"}),e.jsx("option",{value:"Tech_Chomu",children:"Tech Chomu"}),e.jsx("option",{value:"Crypto_Fraud",children:"Crypto Fraud"}),e.jsx("option",{value:"TikTokiya",children:"TikTokiya"}),e.jsx("option",{value:"Bollywood_Drama",children:"Bollywood Drama"}),e.jsx("option",{value:"Tharki_Chacha",children:"Tharki Chacha"}),e.jsx("option",{value:"Hostel_Dost",children:"Hostel Dost"}),e.jsx("option",{value:"Shayar_Bewda",children:"Shayar Bewda"}),e.jsx("option",{value:"Petty_Chaiwala",children:"Petty Chaiwala"}),e.jsx("option",{value:"Thug_Dadi",children:"Thug Dadi"}),e.jsx("option",{value:"Rickshaw_Wala",children:"Rickshaw Wala"})]}),e.jsx("button",{className:"generate-btn",type:"submit",onClick:w,children:"Generate"}),e.jsxs("button",{className:"create_post-btn",onClick:E,children:[e.jsx("span",{children:"Create"})," Post"]})]})]})]})};export{ce as default};
