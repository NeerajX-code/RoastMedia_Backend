import{v as k,w as E,b as $,r as c,a as L,K as n,j as e,L as R,G as _}from"./index-BBlMiJUd.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],O=k("check-check",z);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],P=k("check",D);function A(){const{otherId:o}=E(),{user:y}=$(s=>s.userReducer),[g,d]=c.useState([]),[h,p]=c.useState(""),[v,m]=c.useState(!1),[S,C]=c.useState(null),[u,I]=c.useState(null),[b,U]=c.useState(!0),j=L();function w({sender:s,text:i,status:t}){return e.jsxs("div",{className:`ig-chat-bubble ${String(s)==="user"?"ig-outgoing":"ig-incoming"}`,children:[e.jsx("span",{children:i}),s==="user"&&e.jsxs("span",{className:"msg-status",children:[t==="sent"&&e.jsx(P,{size:16}),t==="delivered"&&e.jsx(O,{size:16}),t==="seen"&&e.jsx(O,{size:16,style:{color:"#0f37ead3"}})]})]})}const x=c.useRef(null),f=c.useRef(null);c.useEffect(()=>{x.current&&x.current.scrollIntoView({behavior:"auto"}),f.current&&(f.current.scrollTop=f.current.scrollHeight)},[g]),c.useEffect(()=>{if(!n||!o)return;n.emit("joinConversation",{otherId:o});const s=({conversationId:r,messages:a,otherUser:M})=>{console.log("ðŸ“‚ Got conversation messages:",{conversationId:r,messages:a}),I(r),d(a||[]),C(M),U(!1),console.log("otherUser data:",M)},i=r=>{console.log("âœ‰ï¸ New message:",r),d(a=>[...a,r])},t=({isOnline:r})=>m(!!r),l=({userId:r})=>{String(r)===String(o)&&m(!0)};return n.on("conversationMessages",s),n.on("newMessage",i),n.on("isOtherOnline",t),n.on("userOnline",l),()=>{n.off("conversationMessages",s),n.off("newMessage",i),n.off("isOtherOnline",t),n.off("userOnline",l)}},[o]);const N=()=>{!h.trim()||!n||!u||(n.emit("sendMessage",{conversationId:u,otherId:o,text:h}),p(""))};return c.useEffect(()=>{if(!u||!g||g.length===0)return;g.some(i=>String(i.sender)===String(o)&&String(i.status)!=="seen")&&n.emit("seenMessages",u)},[u,g,o]),c.useEffect(()=>{const s=({userId:t,conversationId:l})=>{console.log(`ðŸ‘€ Messages seen by ${t} in conversation ${l}`),d(r=>r.map(a=>String(a.receiver)===String(t)&&a.status!=="seen"?{...a,status:"seen"}:a))},i=({userId:t})=>{String(t)===String(o)&&m(!1),console.log("userId:",t),console.log("otherId:",o),console.log(v)};return n.on("userOffline",i),n.on("messagesSeen",s),n.on("messagesDelivered",({conversationId:t,userId:l})=>{console.log(`âœ… Messages delivered to ${l} in conversation ${t}`),String(l)===String(o)&&d(r=>r.map(a=>a.conversationId.toString()===t&&a.receiver.toString()===l&&String(a.status)=="sent"?{...a,status:"delivered"}:a))}),()=>{n.off("messagesSeen",s),n.off("userOffline",i),n.off("messagesDelivered")}},[]),b?e.jsx(R,{}):e.jsxs("div",{className:"ig-chat-page",children:[e.jsxs("div",{className:"ig-chat-header",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(_,{size:32,style:{cursor:"pointer"},onClick:()=>j(-1)}),e.jsxs("div",{className:"userProfile",onClick:()=>j(`/other/profile/${o}`),style:{cursor:"pointer",display:"flex"},children:[e.jsxs("div",{className:"ig-chat-avatar",children:[e.jsx("img",{src:S?.avatarUrl||"/default-avatar.png",alt:"avatar"}),e.jsx("span",{className:v?"ig-online":"ig-offline"})]}),e.jsxs("div",{className:"ig-chat-userinfo",children:[e.jsx("div",{className:"ig-chat-username",children:S?.displayName||`User ${o?.slice(0,6)}`}),e.jsx("div",{className:"ig-chat-status",children:v?"Active now":"Offline"})]})]})]}),e.jsxs("div",{className:"ig-chat-messages",ref:f,children:[g.map((s,i)=>e.jsx(w,{sender:String(s?.sender)===String(y?.userId?._id)?"user":"other",text:s?.content||(s?.mediaUrl?"Media":""),status:s?.status},s?._id||i)),e.jsx("div",{ref:x})]}),e.jsxs("div",{className:"ig-chat-inputbar",children:[e.jsx("input",{type:"text",placeholder:"Message...",value:h,onChange:s=>p(s.target.value),onKeyDown:s=>s.key==="Enter"&&N()}),e.jsx("button",{onClick:N,className:"ig-send-btn",children:"Send"})]})]})}export{A as default};
